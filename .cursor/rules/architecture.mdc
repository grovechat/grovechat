---
name: architecture
description: 项目基础架构说明
---

# Overview

GroveChat 是基于 Laravel 12 + Vue 3 + Inertia.js 的全栈应用。底层使用 Go + FrankenPHP 作为运行时（日常开发无需关注）。采用 Action 模式组织业务逻辑，使用 Laravel Data 做类型安全的数据流转，通过 Wayfinder 和 TypeScript Transformer 实现前后端类型同步。

# 技术栈

**开发重点**:
- 后端框架: Laravel 12 + Fortify + Sanctum
- 架构模式: Laravel Actions (lorisleiva/laravel-actions)
- 数据层: Spatie Laravel Data + TypeScript Transformer
- 前端: Vue 3 + Inertia.js + TypeScript + TailwindCSS 4
- 路由生成: Laravel Wayfinder

**底层运行时** (日常开发无需关注):
- Go 1.25 + FrankenPHP (替代传统 PHP-FPM)
- SQLite (main/session/cache/jobs)
- 未来: NATS 消息中心

# 目录结构（开发视角）

```
app/                    # Laravel应用层（主要开发区域）
  ├─ Actions/           # 业务逻辑（Action模式）
  │   ├─ Dashboard/
  │   ├─ Workspace/
  │   └─ SystemSetting/
  ├─ Data/              # 数据传输对象（DTO）
  ├─ Models/            # Eloquent模型
  ├─ Http/              # HTTP层（中间件、少量传统Controller）
  ├─ Services/          # 业务服务
  └─ Settings/          # 系统设置（Spatie Settings）

resources/js/           # Vue 3前端
  ├─ pages/             # Inertia页面组件
  ├─ layouts/           # 布局组件
  ├─ components/        # 组件库
  ├─ composables/       # 组合式函数
  ├─ locales/           # 前端国际化（key为中文）
  ├─ types/             # TS类型定义
  │   └─ generated.d.ts # 自动生成（勿手动编辑）
  ├─ actions/           # Wayfinder生成的前端路由
  └─ routes/            # Wayfinder生成的路由工具

routes/                 # Laravel路由定义
lang/                   # 后端国际化（Laravel标准）
```

# 关键特性

**类型安全的数据流**:
1. 后端定义 Laravel Data（`app/Data/*.php`）
2. 运行 `php artisan typescript:transform` 生成TS类型
3. 前端使用生成的类型（`resources/js/types/generated.d.ts`）
4. 数据自动转换为snake_case（配置于`config/data.php`）

**路由自动生成**:
- Wayfinder自动生成前端路由辅助函数
- 位于 `resources/js/actions` 和 `resources/js/routes`
- 前端通过类型安全的方式调用后端路由

**开发流程**:
```bash
# 终端1: 启动后端服务（通过 Go 启动 FrankenPHP workers）
make

# 终端2: 启动前端开发服务器（Vite，支持热重载）
npm run dev

# 类型生成（修改 Data 类后执行）
php artisan typescript:transform

# 其他常用命令
php artisan test                  # 运行测试
./vendor/bin/pint                 # 代码格式化
```

# 通用逻辑放置约定

为了避免出现大量 “单方法工具类 / Support 目录膨胀”，本项目统一按以下规则收敛：

- **业务用例（可复用流程）**：优先做成 Action（可通过 `SomeAction::run()` 复用与编排）
- **纯转换/映射逻辑**：优先内聚到 “所属对象” 上（Enum / Data / Model 的 static 工厂方法，例如 `EnumOptionData::fromCases()`）
- **基础设施封装（I/O、第三方、框架适配）**：放在 `app/Services/**`（例如 Storage / HTTP client / 外部 SDK 适配）
